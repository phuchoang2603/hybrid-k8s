proxmox:
  secret:
    name: proxmox-credentials
    namespace: default

# IPAM configuration for automatic IP address allocation
ipamProvider:
  enabled: true
  ranges:
    - "10.69.2.1-10.69.2.9"
  prefix: "16"
  gateway: "10.69.0.1"

cluster:
  # Cluster name - will be used as the resource name
  name: dev-cluster

  clusterNetwork:
    apiServerPort: 6443
    serviceDomain: cluster.local
    pods:
      cidrBlocks: ["10.93.0.0/16"]
    services:
      cidrBlocks: ["10.96.0.0/16"]

  controlPlane:
    labels:
      cni: canal
    replicas: 1
    dataStoreName: default

    # Control plane addons
    addons:
      coreDNS: {}
      kubeProxy: {}
      konnectivity: {}

    deployment:
      additionalMetadata:
        labels:
          cluster.x-k8s.io/cluster-name: dev-cluster
        annotations:
          cluster: dev-cluster
      podAdditionalMetadata:
        labels:
          cluster.x-k8s.io/cluster-name: dev-cluster
        annotations:
          cluster: dev-cluster
      # Must provide valid objects/arrays, not empty
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 1
              podAffinityTerm:
                labelSelector:
                  matchLabels:
                    cluster.x-k8s.io/cluster-name: dev-cluster
                topologyKey: kubernetes.io/hostname
      tolerations:
        - key: node.kubernetes.io/not-ready
          operator: Exists
          effect: NoExecute
          tolerationSeconds: 300
      nodeSelector:
        kubernetes.io/os: linux
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              cluster.x-k8s.io/cluster-name: dev-cluster

    kubelet:
      cgroupfs: systemd
      preferredAddressTypes:
        - InternalIP
        - ExternalIP
        - Hostname

    network:
      serviceType: LoadBalancer
      serviceAddress: "10.69.1.138"
      serviceAnnotations:
        kube-vip.io/loadbalancerIPs: "10.69.1.138"
      serviceLabels:
        cluster.x-k8s.io/cluster-name: dev-cluster
      certSANs:
        - "10.69.1.138"
        - "cluster.local"

    # Kubernetes version for control plane
    version: v1.29.6

  # Proxmox configuration
  allowedNodes:
    - pve
    - pve2
    - pve3

  credentialsRef:
    name: proxmox-credentials
    namespace: default

  dnsServers:
    - 10.69.0.1
    - 1.1.1.1

  ipv4Config:
    addresses:
      - 10.69.2.1
      - 10.69.2.2
      - 10.69.2.3
    gateway: 10.69.0.1
    prefix: 16

  # Metrics - requires ServiceMonitor CRD
  metrics:
    enabled: false

# Worker node pools
nodePools:
  - name: default
    replicas: 3

    # Autoscaling configuration (requires Cluster Autoscaler)
    autoscaling:
      enabled: false

    pool: truenas

    # Proxmox node that hosts the template
    sourceNode: pve

    # Allowed nodes for VM placement
    allowedNodes:
      - pve
      - pve2
      - pve3

    # VM template configuration
    # Use template ID
    templateId: 100

    # Network configuration
    network:
      bridge: vmbr1
      model: virtio
      dnsServers:
        - 10.69.0.1
        - 1.1.1.1
      addressesFromPools:
        enabled: true

    # Storage configuration
    storage: truenas
    format: qcow2

    # Disk configuration
    disks:
      bootVolume:
        disk: scsi0
        sizeGb: 50

    # VM resources
    memoryMiB: 4096
    numCores: 2
    numSockets: 1
